# ============================================================================
# POINT-FORCE DRAG VALIDATION FOR COUPLB
#
# Physics: A single particle with mass m in viscous fluid, subject to
# constant external force F. CoupLB's direct-forcing IBM treats each
# atom as a regularized point force (Stokeslet), NOT as a solid sphere.
#
# The correct analytical reference for a point force in periodic Stokes
# flow is NOT F = 6πμRU (that's for a no-slip sphere). Instead, terminal
# velocity depends on the regularization (delta function support) and
# the periodic domain size L.
#
# However, we CAN validate two things:
#   1. Force balance: at steady state, IBM drag = applied force (Newton 3)
#   2. Conservation: total momentum (fluid + particle) evolves linearly
#      with applied force, i.e. d(P_total)/dt = F_external
#
# For quantitative velocity comparison against F=6πμRU, one needs many
# Lagrangian points on a sphere surface. That is a separate test.
#
# Parameters chosen for:
#   - Low Ma (< 0.1): incompressible regime
#   - Low Re: Stokes regime
#   - Good resolution: tau in [0.6, 1.5] for LBM accuracy
#   - Adequate domain: L/dx = 64 cells, periodic in all 3 directions
# ============================================================================

units           lj
dimension       3
boundary        p p p
atom_style      atomic

# Domain: 64x64x64 lattice cells, dx = 0.5 LJ units/cell
# Physical domain: 32 x 32 x 32 LJ units
variable        Ncells equal 64
variable        dx_phys equal 0.5
variable        Lbox equal ${Ncells}*${dx_phys}
variable        half_L equal ${Lbox}/2.0

region          box block -${half_L} ${half_L} -${half_L} ${half_L} -${half_L} ${half_L}
create_box      1 box
create_atoms    1 single 0.0 0.0 0.0

mass            1 1.0

# No interatomic potential needed
pair_style      none

# LBM parameters:
#   nu = 0.1 (lattice units) → tau = 3*0.1 + 0.5 = 0.8 (good accuracy range)
#   rho0 = 1.0
#   mu = rho * nu_phys = rho0 * nu_lattice * dx/dt_lbm
#
# Applied force: small enough for Re << 1 and Ma << 0.3
variable        Fext equal 0.001

timestep        0.005

fix             push all addforce ${Fext} 0.0 0.0

fix             flow all couplb ${Ncells} ${Ncells} ${Ncells} 0.1 1.0 &
                dx ${dx_phys} &
                kernel roma &
                output 500 drag_profile.dat &
                check_every 200

fix             integrate all nve

# ============================================================================
# DIAGNOSTICS
# ============================================================================

# Particle velocity
variable        vx equal vx[1]
variable        vy equal vy[1]
variable        vz equal vz[1]
variable        vmag equal sqrt(v_vx*v_vx+v_vy*v_vy+v_vz*v_vz)

thermo          200
thermo_style    custom step v_vx v_vy v_vz v_vmag

# ============================================================================
# RUN
# ============================================================================

# Phase 1: Let flow develop (particle accelerates toward terminal velocity)
run             10000

# Phase 2: Measure steady-state velocity (should be constant)
print "========================================"
print "  POINT-FORCE DRAG VALIDATION"
print "========================================"
print "  Applied force F_x = ${Fext}"
print "  Measured v_x      = ${vx}"
print "  Measured v_y      = ${vy}  (should be ~0)"
print "  Measured v_z      = ${vz}  (should be ~0)"
print "========================================"
print ""
print "  VALIDATION CHECKS:"
print "  1. v_x should be positive and steady (constant over last 2000 steps)"
print "  2. v_y, v_z should be < 1e-6 (no spurious transverse motion)"
print "  3. CoupLB stats should show constant mass, linear momentum growth"
print ""
print "  NOTE: For quantitative comparison against F=6*pi*mu*R*U,"
print "  distribute Lagrangian markers on a sphere surface."
print "  A single point particle is a regularized Stokeslet,"
print "  not a solid sphere."
print "========================================"
